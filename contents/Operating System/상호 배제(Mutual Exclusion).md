# 상호 배제(Mutex: Mutual Exclusion)
## 생산자-소비자 문제
- 비동기적 프로세스들이 작업 수행을 위해 서로 협동하고, 병행 수행하는 대표적인 예시이다.
- 생산자 프로세스는 소비자 프로세스가 소비하는 정보를 생산한다.
- 상호배제와 동기화를 필요로 한다.

### 생산자-소비자의 공유 버퍼(공유 자원)
- 생산자의 데이터 생산과 소비자의 데이터 소비는 서로 독립적이므로 공유 버퍼를 필요로 한다.
- 생산자와 소비자는 같은 버퍼를 사용하므로 공유 변수에 동시에 접근하는 경우 문제가 발생할 수 있다.
  - 생산자가 이미 채워진 버퍼에 더 채우거나 소비자가 빈 데이터를 꺼낼 때 문제가 발생한다.

#### 유한 버퍼의 구현
- 2개의 논리적 포인터 in과 out을 갖는 queue 순환 배열로 구현한다.
- 순차 리스트 버퍼의 경우 삽입, 삭제시 인덱스와 데이터가 이동하는 오버헤드가 발생하여 비효율적이다.

### 공유 변수 동시 접근 문제
- 공유 변수 조작 부분에 동시에 접근할 시 문제가 발생한다.
#### 공유 변수 동시 접근
- 생산자 프로세스와 소비자 프로세스가 counter 변수에 동시 접근 시 counter에 잘못된 값이 저장될 수 있다.
- 예) counter가 5인 경우

### 경쟁 상태(Race Condition)
- 여러 프로세스가 동시에 공유 데이터에 접근할 때, 접근 순서에 따라 실행 결과가 달라지는 상황을 말한다. 
- 해당 상황을 방지하기 위해서는 병행 프로세스들을 동기화해야 한다.
  - 세마포어(Semaphore)
  - 상호 배제(Mutex)
  - 모니터(Monitor)

## 임계 영역(Cirical Section)
- 다수의 프로세스가 실행 가능한 영역이면서 한 순간에 하나의 프로세스만 실행할 수 있는 영역이다.
- 공유 자원의 독점을 보장하기 위한 코드 영역이다.
- 프로세스가 공유 데이터(임계 자원)에 접근하는 동안 그 프로세스는 임계 영역에 있다고 표현한다. 

### 임계 영역 문제 해결 조건 
1. 상호 배제(Mutex)
   - 한 프로세스가 임계 영역에 있는 경우 다른 프로세스는 진입이 불가능해야 한다.
2. 진행(Progress):
   - 임계 영역에 진입한 프로세스가 없는 상태에서 임계 영역에 진입하려는 여러 프로세스가 있는 경우 선택하여 진입하게 해야한다.
3. 유한 대기(Bounded Waiting)
   - 다른 프로세스의 기아를 방지하기 위해, 임계 영역에 한 번 진입했던 프로세스에게 진입 요청 허가의 제한을 두어 무한정 대기 상태를 막는다.
  
### 임계 영역 문제 해결책의 가정 
- 각 기계어 명령어는 분할할 수 없게 실행한다.
  - 하나의 기계어 명령어를 시작하면 인터럽트의 영향을 받지 않고 해당 명령어를 끝까지 실행한다.
- 각 프로세스가 nonzero speed로 실행한다고 가정한다.
  - nonzero speed: 프로세스가 명령어를 실행하는 도중 멈추는 일이 없다. 
- 프로세스들의 상대적인 속도에 대해서 어떠한 가정을 하지 않는다.

### 임계 영역 문제 해결 방법
- 임계 영역 내 인터럽트를 방지한다.
  - 단일 프로세서 환경에서만 사용할 수 있다.
- 임계 영역에 대한 프로세스 동기화를 진행한다.
  - 한 프로세스가 임계 영역 내에 있을 때 다른 프로세스들은 임계 영역에 진입이 금지된다.
  - 세마포어(Semaphore), 상호배제(Mutex), 모니터(Monitor)가 있다.


## 상호 배제(Mutex)
- 한 순간에 하나의 프로세스만을 사용할 수 있는 공유자원에 대해, 한 프로세스가 공유 자원을 사용하는 동안 다른 프로세스가 그 자원에 접근할 수 없게 차단하는 것을 말한다.
- 상호 배제를 위해서는 프로세스 동기화(synchronization)이 필요하다.
  - 순차적으로 재사용이 가능한 자원을 공유하는 프로세스들이 공유자원을 동시에 사용하지 못하게 실행 제어하기 위해 프로세스 동기화가 필요하다. (쓰기 연산)
  - 순차적 재사용은 자원을 한 프로세스가 사용한 다음 이어서 다른 프로세스가 사용이 가능하다.
- 읽기 연산은 상호배제가 필요하지 않다.
  - 프로세스들이 충돌이 없는 연산을 수행하는 경우 공유 자원에 동시에 접근할 수 있다.

### 상호 배제의 조건
1. 두 개 이상의 프로세스들이 동시에 임계 영역(공유 자원)에 있으면 안된다.
2. 어떤 프로세스도 임계 영역(공유 자원)에 진입하는 것이 무한정 연기되면 안된다.
3. 임계 영역(공유 자원) 안에 있는 프로세스가 다른 프로세스의 임계 영역 진입을 막을 수 있어야 한다.
4. 프로세스들의 상대적인 속도(각 프로세스들의 처리 속도, 접근 방법, 상태)에 대해 어떠한 가정을 하면 안된다.

## 상호 배제 방법
상호 배제, 세마포어, 모니터, 하드웨어 명령어 방법으로 상호 배제와 임계 영역, 동기화 문제를 해결할 수 있다. 
### 상호 배제(Mutex)
### 세마포어(Semaphore)
### 모니터(Monitor)
### 하드웨어 명령어

> ⬆️:[Top](#상호-배제mutex-mutual-exclusion)
> ⬅️:[Back](https://github.com/Minho979/CS_Study/blob/main/README.md#%EF%B8%8F-Operating-System)
> 💁:[Home](https://github.com/Minho979/CS_Study/blob/main/README.md)
> - Reference
> - [구현회. 운영체제-그림으로 배우는 구조와 원리, 개정3판. 한빛아카데미]
